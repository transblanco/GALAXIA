<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Galaxia KPI</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f6fa; margin:0; padding:0; }
    header { background:#2f3640; color:#fff; padding:15px; text-align:center; }
    table { width:90%; margin:20px auto; border-collapse:collapse; background:#fff; }
    th, td { padding:10px; border-bottom:1px solid #ddd; text-align:left; }
    th { background:#eee; }
    .area-tag { padding:4px 8px; border-radius:6px; color:#fff; font-size:0.8em; margin-right:4px; display:inline-block; }
    .RRHH { background:#487eb0; }
    .Comercial { background:#4cd137; }
    .Backus { background:#e1b12c; }
    .Operaciones { background:#e84118; }
    .btn { background:#0097e6; color:#fff; padding:6px 12px; text-decoration:none; border-radius:6px; font-size:0.9em; cursor:pointer; }
    .btn:hover { background:#40739e; }
    #formNuevaTarea { display:none; width:90%; margin:20px auto; background:#fff; padding:20px; border-radius:8px; }
    #formNuevaTarea input, #formNuevaTarea select { width:100%; margin:5px 0; padding:8px; }
    .inline { display:flex; gap:8px; align-items:center; }
    /* Modal gen√©rico */
    .modal { display:none; position:fixed; z-index:10; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
    .modal-content { background:#fff; margin:10% auto; padding:20px; border-radius:8px; width:80%; max-width:400px; }
    .close { float:right; font-size:20px; cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <h1>üöÄ Tablero Galaxia KPI</h1>
    <button class="btn" onclick="solicitarCodigo()">üîë Ingresar como Admin</button>
    <button id="btnNuevaTarea" class="btn" onclick="mostrarFormulario()" style="display:none;">‚ûï Nueva tarea</button>
  </header>

  <table id="tablaTareas">
    <thead>
      <tr>
        <th>√Åreas</th><th>Item</th><th>T√≠tulo</th><th>Niveles</th><th>% Avance</th><th>Responsable</th><th>Carpeta</th>
      </tr>
    </thead>
    <tbody id="tbody"></tbody>
  </table>

  <!-- Formulario Nueva Tarea -->
  <div id="formNuevaTarea">
    <h3>Nueva Tarea</h3>
    <input type="text" id="nuevoTitulo" placeholder="T√≠tulo">
    <input type="text" id="nuevoItem" placeholder="Item">

    <div class="inline">
      <select id="nuevoAreas" multiple></select>
      <button class="btn" onclick="abrirModal('area')">‚ûï Nuevo</button>
    </div>

    <div class="inline">
      <select id="nuevoResponsable"></select>
      <button class="btn" onclick="abrirModal('responsable')">‚ûï Nuevo</button>
    </div>

    <input type="number" id="nuevoAvance" placeholder="% Avance inicial">
    <input type="text" id="nuevoDrive" placeholder="Link Carpeta Drive">
    <input type="text" id="nuevoImagen" placeholder="URL Imagen KPI">
    <button class="btn" onclick="crearTarea()">Guardar Tarea</button>
  </div>

  <!-- Modal Agregar Nuevo -->
  <div id="modalNuevo" class="modal">
    <div class="modal-content">
      <span class="close" onclick="cerrarModalNuevo()">&times;</span>
      <h3 id="modalTitulo"></h3>
      <input type="text" id="nuevoNombre" placeholder="Escriba nombre">
      <button class="btn" onclick="guardarNuevo()">Guardar</button>
    </div>
  </div>

  <script>
    let admin = false;
    let tipoActual = "";
    let listaAreas = ["Comercial","Backus","RRHH","Operaciones"];
    let listaResponsables = ["Juan P√©rez","Mar√≠a L√≥pez"];

    const tareas = [
      {
        titulo: "Cumplimiento de puntos de venta",
        item: "Cobertura",
        areas: ["Comercial"],
        responsable: "Juan P√©rez",
        niveles: ["Nivel 1 ‚úÖ", "Nivel 2 ‚¨ú", "Nivel 3 ‚¨ú", "Nivel 4 ‚¨ú"],
        avance: 25,
        drive: "https://drive.google.com/",
        imagen: "https://via.placeholder.com/600x200.png?text=KPI+Comercial",
        comentarios: []
      }
    ];

    function renderTabla() {
      const tbody = document.getElementById("tbody");
      tbody.innerHTML = "";
      tareas.forEach((tarea, index) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${tarea.areas.map(a=>`<span class="area-tag ${a}">${a}</span>`).join(" ")}</td>
          <td>${tarea.item}</td>
          <td>${tarea.titulo}</td>
          <td>${tarea.niveles.join(" | ")}</td>
          <td>${tarea.avance}%</td>
          <td>${tarea.responsable}</td>
          <td><a href="${tarea.drive}" target="_blank" class="btn">üìÇ Abrir</a></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderSelects() {
      const selAreas = document.getElementById("nuevoAreas");
      selAreas.innerHTML = "";
      listaAreas.forEach(a=>{
        const opt = document.createElement("option");
        opt.value = a;
        opt.textContent = a;
        selAreas.appendChild(opt);
      });

      const selResp = document.getElementById("nuevoResponsable");
      selResp.innerHTML = "";
      listaResponsables.forEach(r=>{
        const opt = document.createElement("option");
        opt.value = r;
        opt.textContent = r;
        selResp.appendChild(opt);
      });
    }

    function solicitarCodigo() {
      const codigo = prompt("Ingrese c√≥digo de administrador:");
      if (codigo === "william.oliva") {
        admin = true;
        document.getElementById("btnNuevaTarea").style.display = "inline-block";
        alert("Acceso concedido ‚úÖ");
      } else {
        alert("C√≥digo incorrecto ‚ùå");
      }
    }

    function mostrarFormulario() {
      renderSelects();
      document.getElementById("formNuevaTarea").style.display = "block";
    }

    function crearTarea() {
      const titulo = document.getElementById("nuevoTitulo").value;
      const item = document.getElementById("nuevoItem").value;
      const areas = Array.from(document.getElementById("nuevoAreas").selectedOptions).map(o=>o.value);
      const responsable = document.getElementById("nuevoResponsable").value;
      const avance = parseInt(document.getElementById("nuevoAvance").value) || 0;
      const drive = document.getElementById("nuevoDrive").value;
      const imagen = document.getElementById("nuevoImagen").value || "https://via.placeholder.com/600x200.png?text=KPI";
      const niveles = ["Nivel 1 ‚¨ú", "Nivel 2 ‚¨ú", "Nivel 3 ‚¨ú", "Nivel 4 ‚¨ú"];

      tareas.push({ titulo, item, areas, responsable, niveles, avance, drive, imagen, comentarios: [] });
      renderTabla();
      document.getElementById("formNuevaTarea").style.display = "none";
    }

    function abrirModal(tipo) {
      tipoActual = tipo;
      document.getElementById("modalTitulo").innerText = "Agregar nuevo " + tipo;
      document.getElementById("nuevoNombre").value = "";
      document.getElementById("modalNuevo").style.display = "block";
    }

    function cerrarModalNuevo() {
      document.getElementById("modalNuevo").style.display = "none";
    }

    function guardarNuevo() {
      const nombre = document.getElementById("nuevoNombre").value.trim();
      if (nombre === "") return;
      if (tipoActual === "area") {
        listaAreas.push(nombre);
      } else if (tipoActual === "responsable") {
        listaResponsables.push(nombre);
      }
      cerrarModalNuevo();
      renderSelects();
    }

    renderTabla();
  </script>
</body>
</html>

